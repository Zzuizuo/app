<view wx:if="{{!session || androidHTMLLoading}}" class="loading">
    <image class="icon" src="/res/images/loading1.png" style="width:100rpx;height:100rpx;" />
</view>
<view class="contentbox">
    <!-- <view class="swiperimg" wx:if="{{images.length > 4}}">
        <image src="{{images[currentImgIndex] ? images[currentImgIndex].url+'@cover7' : ''}}" mode="aspectFill"></image>
    </view> -->

    <view style="position: relative;width: 100vw;height: 375rpx">
        <swiper class="swiper" duration="{{100}}" easing-function="linear" bindchange="handleSwiperCurrent" current="{{swiperCurrent}}" circular autoplay display-multiple-items="{{1}}">
            <block wx:for="{{images}}" wx:key="index">
                <swiper-item style="width: 100vw !important;height: 375rpx !important;">
                    <image src="{{item.url + '@cover7'}}" mode="aspectFill"></image>
                    <!-- <view class="imgbottom">环境</view> -->
                </swiper-item>
            </block>
        </swiper>
        <view wx:if="{{images.length > 1}}" class="listnum center-vertical">
            <view class="listnumcell" wx:if="{{publicPics.length}}" bindtap="handleShowSwiperImg" data-type="pub" style="margin-right: 10rpx">环境 {{ (swiperIndex - 1 && swiperIndex <= publicPics.length + 1) ? (swiperIndex - 1) + ' /' : ''}} {{publicPics.length}}</view>
            <view class="listnumcell" wx:if="{{caiPics.length}}" bindtap="handleShowSwiperImg" data-type="cai">菜品 {{(swiperIndex && swiperIndex > publicPics.length + 1) ? (swiperIndex - publicPics.length - 1) + ' /' : ''}} {{caiPics.length}}</view>
        </view>
    </view>

    <!-- <view class="scrollbox" wx:if="{{images.length > 4}}">
        <scroll-view class="scroll-view" scroll-x="{{true}}" scroll-with-animation="{{true}}" bindscroll="handleScrollImg" enable-flex="{{true}}">
            <view wx:for="{{images}}" wx:key="index" class="scrollitem center-all {{index == currentImgIndex ? 'imgborder' : '' }}">
                <image class="scrollimg" src="{{item.url}}" bindtap="handleShowImg" data-index="{{index}}" mode="aspectFill"></image>
            </view>
        </scroll-view>
    </view> -->
    <view class="pagetop">
        <!-- <image wx:if="{{shop.cover}}" class="coverimg" src="{{shop.cover ? (shop.cover+'@cover7') : '/res/images/kanjia_defalut.png'}}" mode="aspectFill" /> -->
        <view class="line-bottom" style="margin-top: 40rpx">
            <view class="pricebox" style="color: #FF4925;font-size: 32rpx;font-weight: bold">{{gou.bonus.name}}</view>
            <view wx:if="{{gou.amount}}">
                <view class="amountbox" wx:if="{{gou.repeat=='day'}}">剩余<text style="color: #FF4925;font-weight: bold;">{{gou.amount-(gou.data.paidToday || 0)}}</text>份</view>
                <view class="amountbox" wx:else>剩余<text style="color: #FF4925;font-weight: bold;">{{gou.amount-(gou.data.paid || 0)}}</text>份</view>
            </view>
        </view>
        <view class="time" wx:if="{{gou.online}}">
            <view wx:if="{{gou.status==0}}" style="color: #FF4925;">{{gou.startTimeStr}} 开始</view>
            <view wx:if="{{gou.status==1}}"></view>
        </view>
        <view wx:else style="color:#999;">活动未开启</view>
        <view class="title center-vertical" bindtap="toShop">
            <view class="nowrap" style="max-width: 470rpx">{{gou.shop.name}}</view>
            <view style="color: #999;font-size: 24rpx;font-weight: 400">{{gou.shop.feature}} {{gou.shop.cpi ? '人均￥'+gou.shop.cpi : ''}}</view>
        </view>
        <view class="center-vertical" style="font-size: 24rpx;color: #999;margin-top: 20rpx;" bindtap="openLocation">
            <view class="nowrap" style="max-width: 580rpx">{{gou.shop.address}}</view>
            <view class="" wx:if="{{location}}">{{disStr}}</view>
        </view>
        <view class="props">
            <view class="prop">
                <image src="/res/images/cross_b.png" style="width: 24rpx;height: 24rpx;margin-right: 6rpx" /> 30天内限购1份
            </view>
            <view class="prop">
                <image src="/res/images/cross_b.png" style="width: 24rpx;height: 24rpx;margin-right: 6rpx" /> 可转赠
            </view>
            <view class="prop">
                <image src="{{gou.bonus.condition ? '/res/images/icon_tixianfail.png' : '/res/images/cross_b.png'}}" style="width: 24rpx;height: 24rpx;margin-right: 6rpx" /> {{gou.bonus.condition ? '满'+gou.bonus.condition+'元可用' : '无门槛'}}
            </view>
            <view class="prop" wx:if="{{gou.bonus.enjoyWithOther}}">
                <image src="/res/images/cross_b.png" style="width: 24rpx;height: 24rpx;margin-right: 6rpx" /> 优惠同享
            </view>
        </view>
        <view class="goubox">
            <view class="tagbox">砍价优惠全网同享</view>
            <view class="iconbox">
                <image src="/res/images/icon_kan.png"></image>
                <view class="iconboxbottom" style="color: #FF4925;font-size: 28rpx;min-width: 80rpx"><text style="font-size: 36rpx">{{gou.kanPriceStr}}</text>元</view>
            </view>
            <view class="center-vertical" style="font-weight: bold;line-height: 1;color: #999;font-size: 24rpx;">今日{{gou.data.joinToday || 0}}人参与砍价</view>
            <view class="joinedbox">
                <view class="joinimgs">
                    <view class="joinimglist" wx:if="{{actions.length}}">
                        <image class="joinimgcell" wx:for="{{actions}}" wx:key="index" src="{{item.user.headimgurl}}" style="z-index: {{index+1}}" />
                        <image class="joinimgcell" wx:if="{{actions.length>=4}}" style="z-index: 6" src="/res/images/icon_headimgmore.png" />
                    </view>
                    <view class="joinimglist" wx:else>
                        <image class="joinimgcell" wx:for="{{4}}" wx:key="index" src="/res/images/icon_joinuser.png" style="z-index: {{index+1}}" />
                        <image class="joinimgcell" style="z-index: 6" src="/res/images/icon_headimgmore.png" />
                    </view>
                    <view wx:if="{{!gou.online}}" class="goubtn" style="background: #f0f0f0;color: #666;font-size: 20rpx">活动未开启</view>
                    <view wx:else>
                        <view wx:if="{{gou.status==0}}" class="goubtn" style="background: #f0f0f0;color: #666;font-size: 24rpx">{{gou.startTimeStr}} 开始</view>
                        <view wx:if="{{gou.status==2}}" class="goubtn" style="background: #f0f0f0;color: #666;font-size: 24rpx">已经抢光</view>
                        <view wx:if="{{gou.status==1}}">
                            <view wx:if="{{!usergou}}">
                                <view class="goubtn" bindtap="toJoin" style="background: #FFDB09;color: #242627" wx:if="{{user.authed}}">砍一刀</view>
                                <button wx:else class="simple" open-type="getUserInfo" bindgetuserinfo="authThenJoin">
                                    <view class="goubtn" style="background: #FFDB09;color: #242627">砍一刀</view>
                                </button>
                            </view>
                            <view wx:if="{{usergou}}">
                                <view wx:if="{{usergou.paid}}">
                                    <view wx:if="{{usergou.used}}" class="goubtn" style="background: #f0f0f0;color: #666">卡券已使用</view>
                                    <view wx:else>
                                        <view class="goubtn" bindtap="toUse" data-usercoupon="{{usergou.usercoupon}}">查看卡券</view>
                                    </view>
                                </view>
                                <button wx:if="{{!usergou.paid}}" class="normal" open-type="share">
                                    <view class="goubtn" style="background: #FFDB09;color: #242627">继续砍价</view>
                                </button>
                            </view>
                        </view>
                    </view>
                </view>
            </view>
        </view>
    </view>
</view>
<view class="pagebottom">
    <form bindsubmit="saveToken" report-submit>
        <button class="simple" formType="submit">
            <view class="signbox" bindtap="toSetNotice" wx:if="{{!gou.full}}">
                <view class="signbox_left">
                    <!-- <image src="/res/images/icon_sign.png"></image> -->
                    <view style="font-size: 24rpx;color: #666" wx:if="{{gounotice}}">价格低于<text style="color: #FF4925;font-weight: bold;">{{gounotice.priceStr}}元</text>时，系统将发送微信通知您</view>
                    <view style="font-size: 24rpx;color: #666" wx:else>当价格低于设定金额时，微信消息提醒我</view>
                </view>
                <view class="signbtn" wx:if="{{!gounotice}}" style="{{ading?'opacity: 0.2;':''}}">低价提醒</view>
                <view wx:if="{{gounotice}}">
                    <view class="signbtn" style="background-color: unset;" wx:if="{{gounotice}}">修改</view>
                </view>
            </view>
        </button></form>

    <view class="panel" wx:if="{{gou.rule}}">
        <view class="paneltitle">活动规则</view>
        <view class="panelcontent">
            <text decode style="white-space: pre-wrap;">{{gou.rule}}</text>
        </view>
    </view>
    <view class="panel">
        <view class="paneltitle">卡券使用条件</view>
        <view class="ruleitem" style="margin-top: 50rpx">
            <view class="rulecircle"></view>
            <view wx:if="{{(gou.bonus.expiryType=='day' && gou.bonus.expiryDay==7) || !gou.bonus.expiryType}}">领取后7天内有效</view>
            <view wx:if="{{gou.bonus.expiryType=='never'}}">永久有效</view>
            <view wx:if="{{gou.bonus.expiryType=='time'}}">{{gou.bonus.expiryTimeStr}}到期</view>
            <view wx:if="{{gou.bonus.expiryType=='day' && gou.bonus.expiryDay!=7}}">领取后{{gou.bonus.expiryDay}}天内有效</view>
        </view>
        <view class="ruleitem" wx:if="{{(gou.bonus.dayLimit == 'custom' && gou.bonus.dayLimitCustom) || gou.bonus.dayLimit != 'custom'}}">
            <view class="rulecircle"></view>
            <view>{{gou.bonus.dayLimit == 'custom' ? gou.bonus.dayLimitCustom : '节假日通用'}}</view>
        </view>
        <view class="ruleitem" wx:if="{{(gou.bonus.timeLimit == 'custom' && gou.bonus.timeLimitCustom) || gou.bonus.timeLimit != 'custom'}}">
            <view class="rulecircle"></view>
            <view>{{gou.bonus.timeLimit == 'custom' ? gou.bonus.timeLimitCustom : '全天可用'}}</view>
        </view>
        <view class="ruleitem" wx:if="{{(gou.bonus.scope == 'custom' && gou.bonus.scopeCustom) || gou.bonus.scope != 'custom'}}">
            <view class="rulecircle"></view>
            <view wx:if="{{gou.bonus.scope == 'custom'}}">{{gou.bonus.scopeCustom}}</view>
            <view wx:if="{{gou.bonus.scope == 'all' || !gou.bonus.scope}}">全场通用</view>
            <view wx:if="{{gou.bonus.scope == 'cai'}}">仅限菜品与堂食</view>
        </view>
        <view class="ruleitem" wx:if="{{(gou.bonus.appointment == 'custom' && gou.bonus.appointmentCustom) || gou.bonus.appointment != 'custom'}}">
            <view class="rulecircle"></view>
            <view>{{gou.bonus.appointment == 'custom' ? gou.bonus.appointmentCustom : '无需预约，消费高峰期可能需要等位'}}</view>
        </view>
        <view class="ruleitem" wx:if="{{(gou.bonus.person == 'custom' && gou.bonus.personCustom) || gou.bonus.person != 'custom'}}">
            <view class="rulecircle"></view>
            <view>{{gou.bonus.person == 'custom' ? gou.bonus.personCustom : '2人及以上可用'}}</view>
        </view>
        <view class="ruleitem" wx:if="{{gou.bonus.condition}}">
            <view class="rulecircle"></view>
            <view>满{{gou.bonus.condition}}元可用</view>
        </view>
        <view class="ruleitem" wx:if="{{gou.bonus.rule}}">
            <view class="rulecircle"></view>
            <text wx:if="{{gou.bonus.rule}}" decode style="white-space:pre-wrap;color: #242627;flex: 1;line-height: 1.6">{{gou.bonus.rule}}</text>
        </view>
    </view>
    <view class="panel" wx:if="{{gou.bonus.type == 'duihuan' && gou.bonus.includes.length}}">
        <view class="paneltitle">兑换内容</view>
        <view class="panelcontent">
            <view wx:for="{{gou.bonus.includes}}" wx:key="index" class="ruleitem">
                <view class="rulecircle"></view>
                <view style="flex: 1">
                    <view wx:if="{{item.title}}" style="font-weight: bold;font-size: 28rpx;margin-bottom: 30rpx;">{{item.title}}</view>
                    <view wx:for="{{item.cais}}" wx:for-item="cell" class="justify-SB center-vertical" style="flex: 1;margin-bottom: 30rpx;line-height: 1">
                        <view style="font-size: 28rpx;color: #242627">{{cell.name}} <text style="font-size: 24rpx;color: #999">({{cell.amount}}份)</text></view>
                        <view wx:if="{{cell.price}}">价值￥<text style="font-weight: bold">{{cell.price}}</text></view>
                    </view>
                </view>
            </view>
        </view>
    </view>
    <view class="panel">
        <view class="paneltitle">商家信息</view>
        <view class="panelcontent">
            <view class="shopname" style="{{shop.tag1 || shop.tag2 ? 'margin-bottom: 30rpx':'' }}">
                <view class="nowrap" bindtap="toShop" style="max-width: 500rpx">{{shop.name}}</view>
                <view class="attestationbox" wx:if="{{shop.pass}}" bindtap="toLicense" data-license="{{shop.license}}">
                    <image src="/res/images/icon_attestation.png" class="attestation"></image>
                    <view>已认证</view>
                </view>
                <view class="attestationbox" style="border: 1rpx solid #f0f0f0" wx:else bindtap="handleShopPass">
                    <image src="/res/images/icon_unattestation.png" class="attestation"></image>
                    <view style="color: #999">未认证</view>
                </view>
            </view>
            <view class="tagsbox vertical" style="margin-bottom: 40rpx;" wx:if="{{shop.tag1 || shop.tag2}}">
                <view wx:if="{{shop.tag1}}" class="tagitem vertical" style="color: #FE9E00;background: #FFF5E5;margin-right: 10rpx;margin-bottom:{{((shop.tag1.length + shop.tag2.length > 25) && shop.tag2) ? '10rpx' : '0'}}">
                    <image src="/res/images/index_tag.png" style="width: 20rpx;height: 22rpx;margin-right: 10rpx"></image>
                    <view class="nowrap" style="max-width: 320rpx;">{{shop.tag1}}</view>
                </view>
                <view wx:if="{{shop.tag2}}" class="tagitem vertical" style="color: #FF6D26;background: #FFF1EB">“<view class="nowrap" style="max-width: 320rpx;">{{shop.tag2}}</view>”</view>
            </view>
            <view class="panelitem" wx:if="{{shop.openTime}}">
                <view class="panelitemtext">营业时间：{{shop.openTime}}</view>
            </view>
            <view class="panelitem" wx:if="{{shop.contact}}" bindtap="callShop">
                <view class="panelitemtext">客服电话：{{shop.contact}}</view>
                <view class="panelicon">
                    <image src="/res/images/icon_phone.png" />
                </view>
            </view>
            <view class="panelitem" bindtap="handleShowAddrList">
                <view class="panelitemtext" style="line-height: 1.2">{{shop.address}}</view>
                <view class="panelicon">
                    <image src="/res/images/icon_address.png" />
                </view>
            </view>
            <!-- <view class="panelitem" wx:if="{{shop.license}}" bindtap="toLicense" data-license="{{shop.license}}">
                <view class="panelitemtext">营业资质许可</view>
                <view class="panelicon">
                    <image src="/res/images/icon_zizhi.png" />
                </view>
            </view> -->
            <view class="panelitem" wx:if="{{shop.subshops && shop.subshops.length >= 5}}" bindtap="toSubshops">
                <view class="panelitemtext">其余分店</view>
                <view class="panelicon">
                    <image src="/res/images/icon_shop.png" />
                </view>
            </view>
        </view>
        <view class="panelcontent" wx:if="{{shop.subshops && shop.subshops.length < 5}}" wx:for="{{shop.subshops}}" wx:key="index">
            <view class="shopname">
                <view class="nowrap" bindtap="toShop" style="max-width: 500rpx">{{item.name}}</view>
                <!-- <view class="attestationbox" wx:if="{{shop.pass}}">
                    <image src="/res/images/icon_attestation.png" class="attestation"></image>
                    <view>已认证</view>
                </view>
                <view class="attestationbox" style="border: 1rpx solid #f0f0f0" wx:else bindtap="handleShopPass">
                    <image src="/res/images/icon_unattestation.png" class="attestation"></image>
                    <view style="color: #999">未认证</view>
                </view> -->
            </view>
            <view class="panelitem" wx:if="{{item.openTime}}">
                <view class="panelitemtext">营业时间：{{item.openTime}}</view>
            </view>
            <view class="panelitem" wx:if="{{item.contact}}" bindtap="callShop" data-item="{{item}}">
                <view class="panelitemtext">客服电话：{{item.contact}}</view>
                <view class="panelicon">
                    <image src="/res/images/icon_phone.png" />
                </view>
            </view>
            <view class="panelitem" bindtap="handleShowAddrList">
                <view class="panelitemtext" style="line-height: 1.2">{{item.address}}</view>
                <view class="panelicon">
                    <image src="/res/images/icon_address.png" />
                </view>
            </view>
            <!-- <view class="panelitem" wx:if="{{shop.license}}" bindtap="toLicense" data-license="{{shop.license}}">
                <view class="panelitemtext">营业资质许可</view>
                <view class="panelicon">
                    <image src="/res/images/icon_zizhi.png" />
                </view>
            </view> -->
        </view>
    </view>
    <view class="panel" wx:if="{{shop.subCais.length}}">
        <view class="paneltitle">店长推荐 <text style="color: #999;font-weight: 400">({{shop.subCais.length}})</text></view>
        <view class="panelcontent">
            <swiper style="width: 690rpx;height: 260rpx" duration="{{100}}" easing-function="linear" next-margin="280rpx" circular>
                <block wx:for="{{shop.subCais}}" wx:key="index">
                    <swiper-item>
                        <view>
                            <image src="{{item.imgurl + '@cover7'}}" style="width: 400rpx;height: 200rpx;border-radius: 10rpx" mode="aspectFill"></image>
                            <view class="center-all" style="font-size: 28rpx;line-height: 1;margin-top: 20rpx">
                                <view>{{item.name}}</view>
                                <view style="margin-left: 20rpx">￥{{item.price}}</view>
                            </view>
                        </view>
                    </swiper-item>
                </block>
            </swiper>
        </view>
    </view>
    <view class="signbox" bindtap="copyWechatCodeName" wx:if="{{shop.wechatCodeOn && shop.wechatCodeName}}">
        <view class="signbox_left">
            <image src="/res/images/icon_wechart.png" />
            <view>
                <view style="font-weight: bold;max-width: 420rpx">{{shop.wechatCodeName}}</view>
                <view style="font-size: 24rpx;color: #666;margin-top: 8rpx;max-width: 420rpx">{{shop.wechatCodeTips}}</view>
            </view>
        </view>
        <view class="signbtn" wx:if="{{!copied}}">复制名称</view>
        <view class="signbtn" wx:if="{{copied}}">复制成功</view>
    </view>

    <view class="panel" wx:if="{{shop.detailHTML || shop.detailImage}}">
        <view class="paneltitle">活动详情</view>
        <view class="panel-content">
            <view wx:if="{{shop.detailHTML}}">
                <view style="width: 690rpx;overflow: hidden;">
                    <rich-text nodes="{{shop.detailHTML}}" style="max-width:690rpx" />
                </view>
            </view>
            <image wx:if="{{shop.detailImage}}" src="{{shop.detailImage}}" style="width:690rpx;" mode="widthFix" />
        </view>
    </view>

    <view class="panel" wx:if="{{comments.length}}">
        <view style="display: flex;justify-content: space-between;align-items: center;">
            <view class="paneltitle">他们去过</view>
            <view wx:if="{{comments.length==5}}" bindtap="toShop">查看更多</view>
        </view>
        <view class="comments" style="margin-top: 20rpx">
            <view wx:for="{{comments}}" wx:key="index">
                <circle circle-data="{{item}}" circle-index="{{index}}" full="{{true}}" shop="{{false}}" />
            </view>
        </view>
        <view wx:if="{{comments.length==5}}" bindtap="toShop" style="padding: 20rpx 0;color:#aaa;">查看更多人的评价</view>
    </view>

    <view class="combox" style="margin-top: {{(gou.detailHTML || gou.detailImage) ? '0' : '60rpx'}}">
        <serverinfo bindoncontact="handleShowContact"></serverinfo>
    </view>
</view>
<view class="foot">
    <view class="footiconcell">
        <view class="footiconbox" bindtap="toIndex">
            <image src="/res/images/buttonicon_shop.png" />
            <view style="font-size: 20rpx;margin-top: 10rpx">首页</view>
        </view>
        <!-- <button class="simple footiconbox" open-type="share">
            <image src="/res/images/buttonicon_share.png" />
            <view style="font-size: 20rpx;margin-top: 10rpx">分享</view>
        </button> -->
        <view class="footiconbox" bindtap="onSelectPhone">
            <image src="/res/images/buttonicon_phone.png" />
            <view style="font-size: 20rpx;margin-top: 10rpx">咨询</view>
        </view>
        <view class="footiconbox" bindtap="handleGetShareCard">
            <image src="/res/images/share_img.png" />
            <view style="font-size: 20rpx;margin-top: 10rpx">海报</view>
        </view>
    </view>
    <view class="footright">
        <view wx:if="{{!gou.online}}" class="onebtn" style="background: #f0f0f0;color: #666">活动未开启</view>
        <view wx:else>
            <view wx:if="{{usercoupon}}">
                <view wx:if="{{usercoupon.used}}" class="onebtn" style="background: #f0f0f0;color: #666">卡券已使用</view>
                <view wx:else>
                    <view class="onebtn" bindtap="toUse" data-usercoupon="{{usercoupon}}">查看卡券</view>
                </view>
            </view>
            <view wx:else>
                <view wx:if="{{gou.status==0}}" class="onebtn" style="background: #f0f0f0;color: #666;font-size: 24rpx">{{gou.startTimeStr}} 开始</view>
                <view wx:if="{{gou.status==2}}" class="onebtn" style="background: #f0f0f0;color: #666;font-size: 24rpx">已经抢光啦</view>
                <view wx:if="{{gou.status==1}}">
                    <view wx:if="{{!usergou}}" class="twobtn">
                        <view class="twobtnleft column center-all" bindtap="toBuy" wx:if="{{user.authed}}" style="{{vipBonus ? 'background: #1e1e1e;color: #FFD08A' : ''}}">
                            <view>立即抢购</view>
                            <view style="font-size: 20rpx;margin-top: 10rpx" wx:if="{{!vipBonus}}">现价￥{{gou.priceStr}}</view>
                            <view style="font-size: 20rpx;margin-top: 10rpx" wx:else>折后￥{{gou.priceStr}}</view>
                        </view>
                        <button wx:else class="simple" open-type="getUserInfo" bindgetuserinfo="authThenToBuy">
                            <view class="twobtnleft column center-all" style="{{vipBonus ? 'background: #1e1e1e;color: #FFD08A' : ''}}">
                                <view>立即抢购</view>
                                <view style="font-size: 20rpx;margin-top: 10rpx" wx:if="{{!vipBonus}}">现价￥{{gou.priceStr}}</view>
                                <view style="font-size: 20rpx;margin-top: 10rpx" wx:else>折后￥{{gou.priceStr}}</view>
                            </view>
                        </button>
                        <view class="twobtnright" bindtap="toJoin" wx:if="{{user.authed}}">砍一刀</view>
                        <button wx:else class="simple" open-type="getUserInfo" bindgetuserinfo="authThenJoin">
                            <view class="twobtnright">砍一刀</view>
                        </button>
                    </view>
                    <view wx:else class="twobtn">
                        <view class="twobtnleft column center-all" bindtap="toBuy" style="{{vipBonus ? 'background: #1e1e1e;color: #FFD08A' : ''}}">
                            <view>立即抢购</view>
                            <view style="font-size: 20rpx;margin-top: 10rpx" wx:if="{{!vipBonus}}">现价￥{{gou.priceStr}}</view>
                            <view style="font-size: 20rpx;margin-top: 10rpx" wx:else>折后￥{{gou.priceStr}}</view>
                        </view>
                        <button class="normal" open-type="share">
                            <view class="twobtnright">继续砍价</view>
                        </button>
                    </view>
                </view>
            </view>
        </view>

        <view class="waitpaybox" wx:if="{{usergou && usergou.paying}}" bindtap="pay">
            <view class="waitpayboxbg" wx:if="{{usergou && usergou.paying}}" />
            <view style="z-index: 2;">你有一笔订单尚未支付</view>
            <view class="paybox">立即支付</view>
        </view>

        <view class="vipedbox" wx:if="{{usercoupon && remanentDay}}">
            <view class="waitpayboxbg" style="background: #FF4925" />
            <view style="z-index: 2;color: #fff">{{remanentDay}} 天后可再次购买</view>
        </view>

        <!-- <view class="vipedbox" wx:if="{{!usergou.paying && vipBonus && (gou.status==1)}}" style="background: #FF4925;color: #fff;font-size: 20rpx">
            <view style="z-index: 2;">黑卡特权每日半价</view>
        </view> -->

        <!-- <view class="vipbox" bindtap="toVip" style="background: #1e1e1e;color: #FFD08A;font-size: 20rpx;right: 30rpx" wx:if="{{!vipBonus && !usergou.paying && (gou.status==1)}}">
            <view style="z-index: 2;">黑卡会员每天首次抢购均可享受 5 折优惠</view>
            <view class="paybox" style="background: #FFD08A;color: #242627">立即加入</view>
        </view> -->
    </view>
</view>

<view class="mask-dark" wx:if="{{joinModal}}" bindtap="hideJoinModal">
    <view catchtap="doNothing">
        <view class="mask-card" style="width: 590rpx;padding:70rpx 0 70rpx 0" catchtap="doNothing">
            <image src="/res/images/icon_userkanjia.png" style="width:476rpx;height: 211rpx;display: block;margin: 0 auto;" />
            <view class="card-body" style="text-align:center">
                <view style="color:#242627;font-size: 32rpx;font-weight: bold;margin-top: 60rpx;line-height:1;">少侠好刀法！一刀砍掉<text style="color: #f65459">{{usergou.valueStr}}</text>元</view>
                <view class="listcell" style="margin-top: 72rpx;">
                    <view class="cellleft">
                        <view class="sale">
                            <view><text style="font-size: 36rpx;font-weight: bold">{{usergou.gou.originPrice}}</text>元</view>
                            <view style="margin-top: 24rpx">代金券</view>
                        </view>
                    </view>
                    <view class="cellright">
                        <view class="cellrightname nowrap">{{usergou.gou.shop.name}}</view>
                        <view class="shop">{{gou.bonus.condition ? '满'+gou.bonus.condition+'元可用' : '无门槛'}} 可转赠</view>
                    </view>
                    <view class="circlecover" />
                    <view class="circlecover1" />
                    <view class="rotatebox" class="rotatebox" wx:if="{{!gou.repeat}}">仅剩{{gou.amount - (gou.data.paid||0)}}份</view>
                    <view class="rotatebox" wx:if="{{gou.repeat=='day'}}">仅剩{{gou.amount - (gou.data.paidToday||0)}}份</view>
                </view>
                <view style="font-size: 24rpx;color: #999;text-align: center;line-height:1;margin-top: 40rpx">当前价格：<text style="font-size: 32rpx;color: #FF4925">{{gou.kanPriceStr}}</text><text style="color: #ff4925">元</text></view>
            </view>
            <view wx:if="{{!vipBonus}}">
                <view wx:if="{{user.phone}}" class="maskbtn" style="margin-top: 40rpx" bindtap="buy">立即抢购</view>
                <button wx:else class="normal" open-type="getPhoneNumber" bindgetphonenumber="setPhoneThenJoin" data-buy="{{true}}">
                    <view class="maskbtn center-all" style="margin-top: 40rpx">立即抢购</view>
                </button>
            </view>
            <view wx:else class="maskbtn" style="margin-top: 40rpx;color: #FFD08A;background: #1e1e1e;" bindtap="buy">￥{{gou.priceStr}} 立即抢购</view>
        </view>
    </view>
</view>

<view class="mask-dark" wx:if="{{buyModal}}" bindtap="hideBuyModal">
    <view catchtap="doNothing">
        <view class="shoppingbox">
            <form bindsubmit="saveToken" report-submit>
                <button class="normal" formType="submit">
                    <view class="productinfo">
                        <view class="productinfotop">
                            <image src="{{shop.cover ? (shop.cover+'@cover7') : '/res/images/kanjia_defalut.png'}}" mode="aspectFill" />
                            <view class="productinforight">
                                <view class="productname ellipsis">{{gou.name}}</view>
                                <view class="pricebox">
                                    原价<view class="originPrice">{{gou.originPriceStr}}元</view>
                                </view>
                            </view>
                        </view>
                        <view class="productinfobottom">
                            <view class="signbox_left">
                                <view>当前金额</view>
                            </view>
                            <view class="targetPrice"><text style="font-size: 36rpx">{{gou.priceStr}}</text>元</view>
                        </view>
                    </view>
                    <view class="paybtn justify-SB" wx:if="{{!vipBonus}}">
                        <view class="center-all column" bindtap="toVip" style="width: 250rpx;font-size: 20rpx;color: #FFD08A;background: #1e1e1e;heihgt: 120rpx">
                            <view style="font-size: 32rpx">加入黑卡会员</view>
                            <view style="margin-top: 10rpx">每日首单半价</view>
                        </view>
                        <view wx:if="{{user.phone}}" class="center-all" bindtap="buy" style="flex: 1">立即支付</view>
                        <button wx:else class="normal" style="flex: 1" open-type="getPhoneNumber" bindgetphonenumber="setPhoneThenJoin" data-buy="{{true}}">
                            <view class="center-all" style="height: 120rpx;color: #fff">立即支付</view>
                        </button>
                    </view>
                    <view class="paybtn justify-SB" wx:if="{{vipBonus}}">
                        <view class="center-all column" style="width: 250rpx;font-size: 20rpx;color: #FFD08A;background: #1e1e1e;heihgt: 120rpx">
                            <view style="font-size: 32rpx">黑卡特权</view>
                            <view style="margin-top: 10rpx">本单可享半价</view>
                        </view>
                        <view wx:if="{{user.phone}}" class="center-all" style="flex: 1" bindtap="buy">立即支付</view>
                        <button wx:else class="normal" style="flex: 1" open-type="getPhoneNumber" bindgetphonenumber="setPhoneThenJoin" data-buy="{{true}}">
                            <view class="center-all" style="height: 120rpx;color: #fff">立即支付</view>
                        </button>
                    </view>
                </button>
            </form>
        </view>
    </view>
</view>

<view class="mask-dark" wx:if="{{paidModal}}" bindtap="hidePaidModal">
    <view catchtap="doNothing">
        <form bindsubmit="saveToken" report-submit>
            <button class="simple" formType="submit">
                <view class="paidbox">
                    <image src="/res/images/bg_paid.png" class="paidbg"></image>
                    <view class="paidboxcontent column">
                        <view class="paidtxt1">支付成功</view>
                        <view class="paidtxt2">此券已加入您的券包</view>
                        <view class="paidtxt3 nowrap" style="max-width: 500rpx">{{gou.name}}</view>
                        <view class="paidtxt4 nowrap" style="max-width: 500rpx">{{shop.name}}</view>
                        <view class="paidtxt4" style="color: #999">{{couponExpiry ? couponExpiry + '过期' : ''}}</view>
                        <view class="paidBtn" bindtap="toUse" data-usercoupon="{{usergou.usercoupon}}">查看凭证</view>
                        <view class="paidtips">到店出示凭证即可使用</view>
                    </view>
                    <view class="signbox" data-content="ss317903133" bindtap="handleCopy" bindlongpress="handleCopy" style="background: #FFF8CE;padding: 0 20rpx">
                        <view class="signbox_left">
                            <image src="http://cdn.classx.cn/tandian/2455e313f229ac53acc80136f32cc3f.jpg@avatar" style="border-radius: 48rpx;height: 48rpx;width:48rpx;"></image>
                            <view>
                                <view style="font-size: 24rpx;font-weight: bold;margin-bottom: 8rpx;">小师妹</view>
                                <view style="font-size: 20rpx;color: #666;">加客服微信，<text style="color: #111;font-weight: bold;"></text>领福利进群，找到组织！</view>
                            </view>
                        </view>
                        <view class="signbtn center-all" style="font-size: 20rpx" catchtap="handleCopy" data-content="ss317903133">复制微信号</view>
                    </view>
                </view>
            </button>
        </form>
    </view>
</view>

<view class="mask-dark" wx:if="{{passModal}}" bindtap="hidePassModal">
    <view catchtap="doNothing">
        <view style="background: #fff;width:590rpx;border-radius: 8rpx;padding: 70rpx 0;box-sizing: border-box">
            <view class="joinsuccessbox" style="padding: 0 40rpx;line-height: 1">
                <image src="/res/images/icon_tixianfail.png" style="width: 178rpx;height: 178rpx" />
                <view style="margin-top: 60rpx;font-size: 32rpx;color: #242627;font-weight: 500;text-align: center;width: 400rpx;line-height: 1">该商家信息未经平台官方认</view>
                <view style="margin-top: 20rpx;font-size: 32rpx;color: #242627;font-weight: 500;text-align: center;width: 400rpx;line-height: 1">请自行识别风险</view>
                <view class="maskbtnbox" style="margin-top: 80rpx">
                    <view class="allbtn" style="width: 160rpx;border: 1rpx solid #f0f0f0;border-box: box-sizing" bindtap="handleReport">举报</view>
                    <view class="allbtn" style="width: 300rpx;background: #FFDB09" bindtap="hidePassModal">继续砍价</view>
                </view>
            </view>
        </view>
    </view>
</view>

<view class="mask-dark" wx:if="{{fullModal}}" bindtap="hideFullModal">
    <view catchtap="doNothing">
        <view class="mask-card" style="width: 590rpx;padding:70rpx 0 " catchtap="doNothing">
            <image src="/res/images/mask_nomore.png" style="width:225rpx;height: 170rpx;display: block;margin: 0 auto 70rpx;" />
            <view class="card-body" style="text-align:center;padding-bottom:70rpx;">
                <view style="color:#242627;font-size: 32rpx;font-weight: bold;">手慢了，商品已经被抢光啦</view>
                <view style="margin-top:30rpx;color: #aaa;">支付的款项稍后将原路退回</view>
            </view>
            <view class="maskbtn" bindtap="hideFullModal">我知道了</view>
        </view>
    </view>
</view>

<view class="mask-dark" wx:if="{{noticeModal}}" bindtap="hideNoticeModal">
    <view catchtap="doNothing">
        <view style="background: #fff;width:544rpx;border-radius: 10rpx;text-align: center;position: relative;padding-top: 80rpx;padding-bottom: 40rpx;">
            <view style="color:#333;">提醒价格</view>
            <input type="digit" style="margin: 40rpx;background-color: #f8f8f8;border-radius: 60rpx;height: 100rpx;font-size: 80rpx;color: #FF4925" value="{{noticeForm.priceStr}}" bindfocus="priceFocus" bindinput="priceChanged" bindblur="priceBlur"></input>
            <view style="text-align: left;width:460rpx;margin: 60rpx auto 0 auto">
                <view style="margin-top: 12rpx;text-align: center;color: #aaa;">价格低于此金额时，微信消息提醒</view>
            </view>
            <view class="maskbtn" style="margin-top: 40rpx;" bindtap="noticeConfirm">确定</view>
        </view>
    </view>
</view>

<view class="mask-dark" wx:if="{{showContactModal}}" bindtap="hideContactModal">
    <view class="mask-card" style="width:590rpx;min-height:600rpx;border-radius: 10rpx;padding-bottom: 30rpx " catchtap="doNothing">
        <image src="http://cdn.classx.cn/tandian/userapp/res/images/image_contact.jpg" data-image="http://cdn.classx.cn/tandian/userapp/res/images/image_contact.jpg" style="width: 590rpx;height: 784rpx;margin: 0 auto 0 auto;display: block;border-radius: 10rpx" data-image="http://cdn.classx.cn/tandian/userapp/res/images/image_contact.jpg" bindtap="handlePreviewImg" bindlongpress="handlePreviewImg"></image>
        <view class="mask-btn" style="margin: 20rpx auto 10rpx auto" catchtap="handleCopy" data-content="ss317903133">复制微信号</view>
    </view>
</view>

<!-- vip -->

<mask wx:if="{{vipModal}}" bindtap="hideVipModal" bindcancel="hideVipModal" css="background: #1e1e1e">
    <view slot="maskcard" class="center-all column vipmask">
        <image class="maskbg" src="/res/images/bg_vip.png" mode="widthFix"></image>
        <view class="center-vertical titlebox">
            <image class="viptag" src="/res/images/mask_viptag.png"></image>
            <view style="font-size: 40rpx;font-weight: bold">黑卡会员特权</view>
        </view>
        <view class="text1" wx:if="{{user.vip.expiryTimeStr}}">{{user.vip.expiryTimeStr}} 到期</view>
        <view class="center-vertical" style="margin-top: 50rpx">
            <view class="center-all column vipcell">
                <image src="/res/images/mask_listicon1.png"></image>
                <view class="text1" style="margin-top: 30rpx">霸王餐特权</view>
                <view class="text2">每天签到可领取的幸运币增加至<text style="color: #FFD08A">3枚</text></view>
            </view>
            <view class="center-all column vipcell" style="margin-left: 20rpx">
                <image src="/res/images/mask_listicon2.png"></image>
                <view class="text1" style="margin-top: 30rpx">抢购特权</view>
                <view class="text2">每天首次抢购均可享受<text style="color: #FFD08A">5折</text>优惠</view>
            </view>
        </view>
        <view wx:if="{{user.vip}}">
            <view class="vipbtn center-all" wx:if="{{promotion}}" bindtap="toBuyVip">
                <view style="text-decoration: line-through;color: #666;margin-right: 20rpx;font-size: 20rpx">￥<text style="font-weight: bold">29.9</text>/月</view>
                <view style="font-weight: bold">立即续费</view>
                <image src="/res/images/mask_limitsale.png" class="image_limit">
                    <view class="imagetxt" style="font-family: monospace">限时优惠 ￥<text style="font-size: 32rpx">{{promotion.price}}</text>/月 剩{{clock.hour}}时{{clock.min}}分{{clock.sec}}秒</view>
                </image>
            </view>
            <view class="vipbtn center-all" wx:else bindtap="toBuyVip">
                <view style="font-weight: bold">￥{{priceStr}} 立即续费</view>
            </view>
        </view>
        <view wx:else>
            <view class="vipbtn center-all" wx:if="{{promotion}}" bindtap="toBuyVip">
                <view style="text-decoration: line-through;color: #666;margin-right: 20rpx;font-size: 20rpx">￥<text style="font-weight: bold">29.9</text>/月</view>
                <view style="font-weight: bold">立即激活</view>
                <image src="/res/images/mask_limitsale.png" class="image_limit">
                    <view class="imagetxt" style="font-family: monospace">限时优惠 ￥<text style="font-size: 32rpx">{{promotion.price}}</text>/月 剩{{clock.hour}}时{{clock.min}}分{{clock.sec}}秒</view>
                </image>
            </view>
            <view class="vipbtn center-all" wx:else bindtap="toBuyVip">
                <view style="font-weight: bold">￥{{priceStr}} 立即激活</view>
            </view>
        </view>
    </view>
</mask>

<view class="mask-dark" bindtap="hidePayModal" wx:if="{{payModal}}" style="color:#333;">
    <view class="payModal" catchtap="doNothing">
        <view style="padding: 0 30rpx 20rpx 30rpx;">
            <view class="title" style="margin-top: 20rpx;margin-bottom: 20rpx;">购买时长</view>
            <view class="options">
                <view class="option" style="{{orderForm.time==1?'background-color: #FF4925;color:white;height: 70rpx;':''}}" bindtap="timeChanged" data-time="{{1}}">1个月</view>
                <view class="option" style="{{orderForm.time==3?'background-color: #FF4925;color:white;height: 70rpx;':''}}" bindtap="timeChanged" data-time="{{3}}">3个月</view>
                <view class="option" style="{{orderForm.time==6?'background-color: #FF4925;color:white;height: 70rpx;':''}}" bindtap="timeChanged" data-time="{{6}}">6个月</view>
                <view class="option" style="{{orderForm.time==12?'background-color: #FF4925;color:white;height: 70rpx;':''}}" bindtap="timeChanged" data-time="{{12}}">1年</view>
            </view>
            <view wx:if="{{promotion}}">
                <view class="title" style="margin-top: 20rpx;">优惠信息</view>
                <view style="color: #FF4925"><text style="color:#333">在 {{promotion.expiryTimeStr}}前 享受优惠价：</text>{{promotion.price}}元/月</view>
            </view>
        </view>
        <view class="buy">
            <view class="xieyi">
                <checkbox-group bindchange="licenseChanged">
                    <checkbox checked="{{true}}" color="#FF4925" value="agree" />
                    我已阅读并同意
                    <text style="color:#FF4925" bindtap="showLicenseModal">《服务协议》</text>
                </checkbox-group>
            </view>
            <view>
                <view class="confirm" bindtap="payVip" style="line-height: 1;">
                    <view>
                        <view style="font-size: 22rpx;text-decoration: line-through;margin-bottom: 10rpx;" wx:if="{{orderForm.originPrice != orderForm.price}}">原价{{orderForm.originPriceStr}}元</view>
                        <view style="font-weight:bold">{{orderForm.priceStr}}元</view>
                    </view>
                </view>
            </view>
        </view>
    </view>
</view>

<view class="mask-dark" bindtap="hideLicenseModal" wx:if="{{licenseModal}}" style="color:#333;z-index: 9999;align-items: flex-end">
    <scroll-view scroll-y="true" style="width: 100vw;height: 100vh;">
        <view class="jiecard-loading" wx:if="{{loading}}">
            <image src="/res/images/logo.png" style="width:400rpx;height:400rpx;opacity:0.3"></image>
        </view>
        <view style="padding-bottom:60rpx;width:660rpx;background: #fff;margin: 120rpx auto;border-radius: 10rpx;z-index: 1111">
            <view class="card-head">服务协议</view>
            <view class="card-body">
                <view>尊敬的用户您好，使用本服务代表您同意本服务所附带的用户协议各项条款。</view>
                <view>本产品由成都植星科技有限公司研发并提供服务。</view>
                <view>未经用户许可公司不会向任何第三方公开、透露用户信息。并对相关信息采用专业加密存储与传输方式，以保障用户信息的安全。</view>
                <view>由于商品特殊性，不支持退款。</view>
                <view>用户在使用本软件及服务时，须自行承担如下来自本公司不可掌控的风险内容，包括但不限于</view>
                <view>· 由于不可抗拒因素可能引起的用户信息丢失、泄漏等风险</view>
                <view>· 用户必须选择与所安装终端设备相匹配的软件版本，否则，由于软件与终端设备型号不相匹配所导致的任何问题或损害，均由用户自行承担</view>
                <view>· 用户将本软件产生的内容向他人转发、分享，因此等传播可能带来的风险和责任</view>
                <view>· 由于网络信号不稳定、网络带宽小等网络原因，所引起的登录失败、资料同步不完整、页面打开速度慢等风险</view>
                <view>· 由于政府政策、法律法规导致服务不能正常提供的</view>
                <view>· 由于第三方平台出现异常导致服务不能正常提供的</view>
            </view>
        </view>
        <view class="jie" wx:if="{{!loading}}">我知道了</view>
    </scroll-view>
</view>

<view class="mask-dark" wx:if="{{shareModal}}" catchtouchmove='ture'>
    <view catchtap="doNothing">
        <view class="masktop" style="height: calc(100% - 260rpx)" bindtap="hideShareModal">
            <view class="center-all column" style="margin-top: 500rpx">
                <progress percent="{{percent}}" style="width: 400rpx" stroke-width="6" border-radius="3" activeColor="#D24D39" />
                <view style="font-size: 24rpx;color: #fff;margin-top: 20rpx">海报生成中{{percent || 0}}%</view>
            </view>
            <image src="{{imgs[0]}}" class="canvasbox" style="width: 450rpx;height: 800rpx" catchtap="handlePreviewImg" data-image="{{imgs[0]}}"></image>
            <canvas canvas-id="canvas" wx:if="{{!showImage}}" id="canvas" catchtap="handleDrawimg" class="canvasbox" style="width: 750rpx;height: 1334rpx;position:fixed;top: 200%"></canvas>
        </view>
        <view class="maskbottom">
            <view class="sharetext">
                <view wx:if="{{user.channel}}">好友通过本次分享购买，你可以获得20%佣金</view>
                <view wx:else>分享给朋友，和朋友一起吃喝玩乐吧</view>
            </view>
            <view class="center-all">
                <button class="normal" open-type="share" style="flex: 1">
                    <view class="maskbottombtn">
                        <image src="/res/images/share_wechart.png" />
                        <view style="font-size: 24rpx;margin-top: 6rpx">分享好友</view>
                    </view>
                </button>
                <view wx:if="{{authPhoto}}" class="maskbottombtn" bindtap="handleSaveImg">
                    <image src="/res/images/share_save.png" />
                    <view style="font-size: 24rpx;margin-top: 6rpx">保存卡片</view>
                </view>
                <button wx:else class="normal" open-type="openSetting" style="flex: 1">
                    <view class="maskbottombtn">
                        <image src="/res/images/share_save.png" />
                        <view style="font-size: 24rpx;margin-top: 6rpx">分享好友</view>
                    </view>
                </button>
            </view>
        </view>
    </view>
</view>

<view class="mask-dark" wx:if="{{callModal}}" bindtap="onHideCallModal" catchtouchmove='ture'>
    <view catchtap="doNothing">
        <view class="maskcontent-bottom">
            <view class="content-cell center-vertical" style="height: 140rpx">
                <view class="maskcellleft">
                    <view class="maskcelllefttitle">联系商家</view>
                    <view class="maskcelltips">欢迎致电预约或咨询</view>
                </view>
                <view class="maskcellbtn" bindtap="callShop">拨打电话</view>
            </view>
            <view class="maskline center-all" style="height: 1rpx"></view>
            <view class="content-cell center-vertical" style="height: 140rpx">
                <view class="maskcellleft">
                    <view class="maskcelllefttitle">联系客服</view>
                    <view class="maskcelltips">遇到问题可咨询客服</view>
                </view>
                <view class="maskcellbtn" bindtap="oncall" data-phoneNumber="18380459072">拨打电话</view>
            </view>
            <view class="maskline center-all" style="height: 20rpx;width: 100vw"></view>
            <view class="content-cell center-all" style="height: 120rpx" bindtap="onHideCallModal">取消</view>
        </view>
    </view>
</view>


<mask contentType="bottom" wx:if="{{showAddrListModal}}" bindtap="hideAddrListModal" bindcancel="hideAddrListModal">
    <view slot="masklist" class="masklist">
        <view class="itemtitle">当前店铺</view>
        <view class="maskitem center-vertical justify-SB" bindtap="openLocation">
            <view>
                <view>{{shop.name}}</view>
                <view class="center-vertical" style="font-size: 24rpx;color: #999;margin-top: 30rpx">
                    <view style="margin-right: 10rpx">{{disStr}} | </view>
                    <view class="nowrap" style="max-width: 450rpx">{{shop.address}}</view>
                </view>
            </view>
            <view class="panelicon">
                <image src="/res/images/icon_address.png" />
            </view>
        </view>
        <view class="splitline" wx:if="{{shop.subshops.length > 0}}"></view>
        <view class="itemtitle" wx:if="{{shop.subshops.length > 0}}">其他店铺</view>
        <view class="maskitem center-vertical justify-SB" wx:if="{{shop.subshops.length > 0}}" wx:for="{{shop.subshops}}" wx:key="index" bindtap="openLocation" data-item="{{item}}">
            <view>
                <view>{{item.name}}</view>
                <view class="center-vertical" style="font-size: 24rpx;color: #999;margin-top: 30rpx">
                    <view style="margin-right: 10rpx">{{item.distance}} | </view>
                    <view class="nowrap" style="max-width: 450rpx">{{item.address}}</view>
                </view>
            </view>
            <view class="panelicon">
                <image src="/res/images/icon_address.png" />
            </view>
        </view>
    </view>
</mask>